var gbooks = require('google-books-search');
var _ = require('underscore');
var userProfile = require('userprofile');



exports.search = function(req, res){
	console.log('search here');
	var term = req.params.term;
	var taxonomy = req.params.taxonomy;


	var searchOptions = {
		field: taxonomy,
		type: 'books',
		lang: 'pt'
	};

	var output = [];

	gbooks.search(term, searchOptions, function(err, results){
		if(!err){
			_.each(results, function(val){
				var _book = {
					id: val.id,
					title: val.title,
					authors: val.authors,
					thumbnail: val.thumbnail
				};

				output.push(_book);
			});
			res.send(output);
		}else{
			res.send(err);
		}
	});
}


exports.getShelf = function(req, res){
	console.log('getShelf');
	console.log(req.user.bookshelf);
	res.send(req.user.bookshelf);
}

exports.addToShelf = function(req, res){
	res.send('adding to shelf');
}

exports.updateShelfItem = function(req, res){
	res.send('updatng shelf item');
}


exports.syncShelf = function(req, res){
	req.user.bookshelf = req.body;
	userProfile.sync(req.user).then(function(result){

		res.send(200);
	}).catch(function(error){
		console.log('Caught error');
		console.log(error);
	});
}